import{P as O,a as j,S as I,E as zt,T as P,N as it}from"./prosemirror-state.669ab027.js";import{E as Kt}from"./prosemirror-view.2d8901b7.js";import{k as _t}from"./prosemirror-keymap.d8b22547.js";import{D as Vt,F as _,S as qt,a as Wt,b as Ut}from"./prosemirror-model.a115b74d.js";import{l as Jt,j as Et,c as V,R as Gt,a as Yt,b as xt}from"./prosemirror-transform.3cf32640.js";import{c as Qt,d as Xt,e as Zt,j as te,a as ee,b as ne,f as se,g as re,h as oe,l as ie,i as ae,n as ce,s as le,k as de,m as ue,o as pe,p as fe,q as mt,w as he}from"./prosemirror-commands.0a3dea2e.js";import{l as me,s as ge,w as ye}from"./prosemirror-schema-list.6d4dac38.js";import{t as Tt}from"./tippy.js.4b0d142c.js";import{d as z,a as ve,m as be,b as at,o as Ct,c as ct,h as N,e as we,w as ke,f as Me,n as Se,u as Ee,g as xe}from"./@vue.f27b34cb.js";function J(n){const{state:t,transaction:e}=n;let{selection:s}=e,{doc:r}=e,{storedMarks:o}=e;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return o},get selection(){return s},get doc(){return r},get tr(){return s=e.selection,r=e.doc,o=e.storedMarks,e}}}class G{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:s}=this,{view:r}=e,{tr:o}=s,i=this.buildProps(o);return Object.fromEntries(Object.entries(t).map(([a,c])=>[a,(...p)=>{const d=c(...p)(i);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(o),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:s,editor:r,state:o}=this,{view:i}=r,a=[],c=!!t,l=t||o.tr,p=()=>(!c&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&i.dispatch(l),a.every(u=>u===!0)),d={...Object.fromEntries(Object.entries(s).map(([u,f])=>[u,(...g)=>{const y=this.buildProps(l,e),v=f(...g)(y);return a.push(v),d}])),run:p};return d}createCan(t){const{rawCommands:e,state:s}=this,r=!1,o=t||s.tr,i=this.buildProps(o,r);return{...Object.fromEntries(Object.entries(e).map(([c,l])=>[c,(...p)=>l(...p)({...i,dispatch:void 0})])),chain:()=>this.createChain(o,r)}}buildProps(t,e=!0){const{rawCommands:s,editor:r,state:o}=this,{view:i}=r,a={tr:t,editor:r,view:i,state:J({state:o,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(s).map(([c,l])=>[c,(...p)=>l(...p)(a)]))}};return a}}class Te{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const s=this.callbacks[t];return s&&s.forEach(r=>r.apply(this,e)),this}off(t,e){const s=this.callbacks[t];return s&&(e?this.callbacks[t]=s.filter(r=>r!==e):delete this.callbacks[t]),this}removeAllListeners(){this.callbacks={}}}function m(n,t,e){return n.config[t]===void 0&&n.parent?m(n.parent,t,e):typeof n.config[t]=="function"?n.config[t].bind({...e,parent:n.parent?m(n.parent,t,e):null}):n.config[t]}function Y(n){const t=n.filter(r=>r.type==="extension"),e=n.filter(r=>r.type==="node"),s=n.filter(r=>r.type==="mark");return{baseExtensions:t,nodeExtensions:e,markExtensions:s}}function Pt(n){const t=[],{nodeExtensions:e,markExtensions:s}=Y(n),r=[...e,...s],o={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return n.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage},c=m(i,"addGlobalAttributes",a);if(!c)return;c().forEach(p=>{p.types.forEach(d=>{Object.entries(p.attributes).forEach(([u,f])=>{t.push({type:d,name:u,attribute:{...o,...f}})})})})}),r.forEach(i=>{const a={name:i.name,options:i.options,storage:i.storage},c=m(i,"addAttributes",a);if(!c)return;const l=c();Object.entries(l).forEach(([p,d])=>{const u={...o,...d};typeof(u==null?void 0:u.default)=="function"&&(u.default=u.default()),(u==null?void 0:u.isRequired)&&(u==null?void 0:u.default)===void 0&&delete u.default,t.push({type:i.name,name:p,attribute:u})})}),t}function E(n,t){if(typeof n=="string"){if(!t.nodes[n])throw Error(`There is no node type named '${n}'. Maybe you forgot to add the extension?`);return t.nodes[n]}return n}function lt(...n){return n.filter(t=>!!t).reduce((t,e)=>{const s={...t};return Object.entries(e).forEach(([r,o])=>{if(!s[r]){s[r]=o;return}if(r==="class"){const a=o?o.split(" "):[],c=s[r]?s[r].split(" "):[],l=a.filter(p=>!c.includes(p));s[r]=[...c,...l].join(" ")}else r==="style"?s[r]=[s[r],o].join("; "):s[r]=o}),s},{})}function st(n,t){return t.filter(e=>e.attribute.rendered).map(e=>e.attribute.renderHTML?e.attribute.renderHTML(n.attrs)||{}:{[e.name]:n.attrs[e.name]}).reduce((e,s)=>lt(e,s),{})}function At(n){return typeof n=="function"}function b(n,t=void 0,...e){return At(n)?t?n.bind(t)(...e):n(...e):n}function Ce(n={}){return Object.keys(n).length===0&&n.constructor===Object}function Pe(n){return typeof n!="string"?n:n.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(n):n==="true"?!0:n==="false"?!1:n}function gt(n,t){return n.style?n:{...n,getAttrs:e=>{const s=n.getAttrs?n.getAttrs(e):n.attrs;if(s===!1)return!1;const r=t.reduce((o,i)=>{const a=i.attribute.parseHTML?i.attribute.parseHTML(e):Pe(e.getAttribute(i.name));return a==null?o:{...o,[i.name]:a}},{});return{...s,...r}}}}function yt(n){return Object.fromEntries(Object.entries(n).filter(([t,e])=>t==="attrs"&&Ce(e)?!1:e!=null))}function Ae(n,t){var e;const s=Pt(n),{nodeExtensions:r,markExtensions:o}=Y(n),i=(e=r.find(l=>m(l,"topNode")))===null||e===void 0?void 0:e.name,a=Object.fromEntries(r.map(l=>{const p=s.filter(v=>v.type===l.name),d={name:l.name,options:l.options,storage:l.storage,editor:t},u=n.reduce((v,k)=>{const w=m(k,"extendNodeSchema",d);return{...v,...w?w(l):{}}},{}),f=yt({...u,content:b(m(l,"content",d)),marks:b(m(l,"marks",d)),group:b(m(l,"group",d)),inline:b(m(l,"inline",d)),atom:b(m(l,"atom",d)),selectable:b(m(l,"selectable",d)),draggable:b(m(l,"draggable",d)),code:b(m(l,"code",d)),defining:b(m(l,"defining",d)),isolating:b(m(l,"isolating",d)),attrs:Object.fromEntries(p.map(v=>{var k;return[v.name,{default:(k=v==null?void 0:v.attribute)===null||k===void 0?void 0:k.default}]}))}),h=b(m(l,"parseHTML",d));h&&(f.parseDOM=h.map(v=>gt(v,p)));const g=m(l,"renderHTML",d);g&&(f.toDOM=v=>g({node:v,HTMLAttributes:st(v,p)}));const y=m(l,"renderText",d);return y&&(f.toText=y),[l.name,f]})),c=Object.fromEntries(o.map(l=>{const p=s.filter(y=>y.type===l.name),d={name:l.name,options:l.options,storage:l.storage,editor:t},u=n.reduce((y,v)=>{const k=m(v,"extendMarkSchema",d);return{...y,...k?k(l):{}}},{}),f=yt({...u,inclusive:b(m(l,"inclusive",d)),excludes:b(m(l,"excludes",d)),group:b(m(l,"group",d)),spanning:b(m(l,"spanning",d)),code:b(m(l,"code",d)),attrs:Object.fromEntries(p.map(y=>{var v;return[y.name,{default:(v=y==null?void 0:y.attribute)===null||v===void 0?void 0:v.default}]}))}),h=b(m(l,"parseHTML",d));h&&(f.parseDOM=h.map(y=>gt(y,p)));const g=m(l,"renderHTML",d);return g&&(f.toDOM=y=>g({mark:y,HTMLAttributes:st(y,p)})),[l.name,f]}));return new Wt({topNode:i,nodes:a,marks:c})}function Z(n,t){return t.nodes[n]||t.marks[n]||null}function vt(n,t){return Array.isArray(t)?t.some(e=>(typeof e=="string"?e:e.name)===n.name):t}const Oe=(n,t=500)=>{let e="";const s=n.parentOffset;return n.parent.nodesBetween(Math.max(0,s-t),s,(r,o,i,a)=>{var c,l;const p=((l=(c=r.type.spec).toText)===null||l===void 0?void 0:l.call(c,{node:r,pos:o,parent:i,index:a}))||r.textContent||"%leaf%";e+=p.slice(0,Math.max(0,s-o))}),e};function dt(n){return Object.prototype.toString.call(n)==="[object RegExp]"}class $e{constructor(t){this.find=t.find,this.handler=t.handler}}const Be=(n,t)=>{if(dt(t))return t.exec(n);const e=t(n);if(!e)return null;const s=[e.text];return s.index=e.index,s.input=n,s.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(e.replaceWith)),s};function K(n){var t;const{editor:e,from:s,to:r,text:o,rules:i,plugin:a}=n,{view:c}=e;if(c.composing)return!1;const l=c.state.doc.resolve(s);if(l.parent.type.spec.code||!!(!((t=l.nodeBefore||l.nodeAfter)===null||t===void 0)&&t.marks.find(u=>u.type.spec.code)))return!1;let p=!1;const d=Oe(l)+o;return i.forEach(u=>{if(p)return;const f=Be(d,u.find);if(!f)return;const h=c.state.tr,g=J({state:c.state,transaction:h}),y={from:s-(f[0].length-o.length),to:r},{commands:v,chain:k,can:w}=new G({editor:e,state:g});u.handler({state:g,range:y,match:f,commands:v,chain:k,can:w})===null||!h.steps.length||(h.setMeta(a,{transform:h,from:s,to:r,text:o}),c.dispatch(h),p=!0)}),p}function Ne(n){const{editor:t,rules:e}=n,s=new O({state:{init(){return null},apply(r,o){const i=r.getMeta(s);if(i)return i;const a=r.getMeta("applyInputRules");return!!a&&setTimeout(()=>{const{from:l,text:p}=a,d=l+p.length;K({editor:t,from:l,to:d,text:p,rules:e,plugin:s})}),r.selectionSet||r.docChanged?null:o}},props:{handleTextInput(r,o,i,a){return K({editor:t,from:o,to:i,text:a,rules:e,plugin:s})},handleDOMEvents:{compositionend:r=>(setTimeout(()=>{const{$cursor:o}=r.state.selection;o&&K({editor:t,from:o.pos,to:o.pos,text:"",rules:e,plugin:s})}),!1)},handleKeyDown(r,o){if(o.key!=="Enter")return!1;const{$cursor:i}=r.state.selection;return i?K({editor:t,from:i.pos,to:i.pos,text:`
`,rules:e,plugin:s}):!1}},isInputRules:!0});return s}function je(n){return typeof n=="number"}class He{constructor(t){this.find=t.find,this.handler=t.handler}}const Ie=(n,t,e)=>{if(dt(t))return[...n.matchAll(t)];const s=t(n,e);return s?s.map(r=>{const o=[r.text];return o.index=r.index,o.input=n,o.data=r.data,r.replaceWith&&(r.text.includes(r.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),o.push(r.replaceWith)),o}):[]};function De(n){const{editor:t,state:e,from:s,to:r,rule:o,pasteEvent:i,dropEvent:a}=n,{commands:c,chain:l,can:p}=new G({editor:t,state:e}),d=[];return e.doc.nodesBetween(s,r,(f,h)=>{if(!f.isTextblock||f.type.spec.code)return;const g=Math.max(s,h),y=Math.min(r,h+f.content.size),v=f.textBetween(g-h,y-h,void 0,"\uFFFC");Ie(v,o.find,i).forEach(w=>{if(w.index===void 0)return;const S=g+w.index+1,x=S+w[0].length,M={from:e.tr.mapping.map(S),to:e.tr.mapping.map(x)},T=o.handler({state:e,range:M,match:w,commands:c,chain:l,can:p,pasteEvent:i,dropEvent:a});d.push(T)})}),d.every(f=>f!==null)}const Fe=n=>{var t;const e=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(t=e.clipboardData)===null||t===void 0||t.setData("text/html",n),e};function Re(n){const{editor:t,rules:e}=n;let s=null,r=!1,o=!1,i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,a=typeof DragEvent<"u"?new DragEvent("drop"):null;const c=({state:p,from:d,to:u,rule:f,pasteEvt:h})=>{const g=p.tr,y=J({state:p,transaction:g});if(!(!De({editor:t,state:y,from:Math.max(d-1,0),to:u.b-1,rule:f,pasteEvent:h,dropEvent:a})||!g.steps.length))return a=typeof DragEvent<"u"?new DragEvent("drop"):null,i=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,g};return e.map(p=>new O({view(d){const u=f=>{var h;s=!((h=d.dom.parentElement)===null||h===void 0)&&h.contains(f.target)?d.dom.parentElement:null};return window.addEventListener("dragstart",u),{destroy(){window.removeEventListener("dragstart",u)}}},props:{handleDOMEvents:{drop:(d,u)=>(o=s===d.dom.parentElement,a=u,!1),paste:(d,u)=>{var f;const h=(f=u.clipboardData)===null||f===void 0?void 0:f.getData("text/html");return i=u,r=!!(h!=null&&h.includes("data-pm-slice")),!1}}},appendTransaction:(d,u,f)=>{const h=d[0],g=h.getMeta("uiEvent")==="paste"&&!r,y=h.getMeta("uiEvent")==="drop"&&!o,v=h.getMeta("applyPasteRules"),k=!!v;if(!g&&!y&&!k)return;if(k){const{from:x,text:M}=v,T=x+M.length,F=Fe(M);return c({rule:p,state:f,from:x,to:{b:T},pasteEvt:F})}const w=u.doc.content.findDiffStart(f.doc.content),S=u.doc.content.findDiffEnd(f.doc.content);if(!(!je(w)||!S||w===S.b))return c({rule:p,state:f,from:w,to:S,pasteEvt:i})}}))}function Le(n){const t=n.filter((e,s)=>n.indexOf(e)!==s);return[...new Set(t)]}class H{constructor(t,e){this.splittableMarks=[],this.editor=e,this.extensions=H.resolve(t),this.schema=Ae(this.extensions,e),this.setupExtensions()}static resolve(t){const e=H.sort(H.flatten(t)),s=Le(e.map(r=>r.name));return s.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${s.map(r=>`'${r}'`).join(", ")}]. This can lead to issues.`),e}static flatten(t){return t.map(e=>{const s={name:e.name,options:e.options,storage:e.storage},r=m(e,"addExtensions",s);return r?[e,...this.flatten(r())]:e}).flat(10)}static sort(t){return t.sort((s,r)=>{const o=m(s,"priority")||100,i=m(r,"priority")||100;return o>i?-1:o<i?1:0})}get commands(){return this.extensions.reduce((t,e)=>{const s={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:Z(e.name,this.schema)},r=m(e,"addCommands",s);return r?{...t,...r()}:t},{})}get plugins(){const{editor:t}=this,e=H.sort([...this.extensions].reverse()),s=[],r=[],o=e.map(i=>{const a={name:i.name,options:i.options,storage:i.storage,editor:t,type:Z(i.name,this.schema)},c=[],l=m(i,"addKeyboardShortcuts",a);let p={};if(i.type==="mark"&&i.config.exitable&&(p.ArrowRight=()=>L.handleExit({editor:t,mark:i})),l){const g=Object.fromEntries(Object.entries(l()).map(([y,v])=>[y,()=>v({editor:t})]));p={...p,...g}}const d=_t(p);c.push(d);const u=m(i,"addInputRules",a);vt(i,t.options.enableInputRules)&&u&&s.push(...u());const f=m(i,"addPasteRules",a);vt(i,t.options.enablePasteRules)&&f&&r.push(...f());const h=m(i,"addProseMirrorPlugins",a);if(h){const g=h();c.push(...g)}return c}).flat();return[Ne({editor:t,rules:s}),...Re({editor:t,rules:r}),...o]}get attributes(){return Pt(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=Y(this.extensions);return Object.fromEntries(e.filter(s=>!!m(s,"addNodeView")).map(s=>{const r=this.attributes.filter(c=>c.type===s.name),o={name:s.name,options:s.options,storage:s.storage,editor:t,type:E(s.name,this.schema)},i=m(s,"addNodeView",o);if(!i)return[];const a=(c,l,p,d)=>{const u=st(c,r);return i()({editor:t,node:c,getPos:p,decorations:d,HTMLAttributes:u,extension:s})};return[s.name,a]}))}setupExtensions(){this.extensions.forEach(t=>{var e;this.editor.extensionStorage[t.name]=t.storage;const s={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:Z(t.name,this.schema)};t.type==="mark"&&((e=b(m(t,"keepOnSplit",s)))!==null&&e!==void 0?e:!0)&&this.splittableMarks.push(t.name);const r=m(t,"onBeforeCreate",s),o=m(t,"onCreate",s),i=m(t,"onUpdate",s),a=m(t,"onSelectionUpdate",s),c=m(t,"onTransaction",s),l=m(t,"onFocus",s),p=m(t,"onBlur",s),d=m(t,"onDestroy",s);r&&this.editor.on("beforeCreate",r),o&&this.editor.on("create",o),i&&this.editor.on("update",i),a&&this.editor.on("selectionUpdate",a),c&&this.editor.on("transaction",c),l&&this.editor.on("focus",l),p&&this.editor.on("blur",p),d&&this.editor.on("destroy",d)})}}function ze(n){return Object.prototype.toString.call(n).slice(8,-1)}function tt(n){return ze(n)!=="Object"?!1:n.constructor===Object&&Object.getPrototypeOf(n)===Object.prototype}function Q(n,t){const e={...n};return tt(n)&&tt(t)&&Object.keys(t).forEach(s=>{tt(t[s])?s in n?e[s]=Q(n[s],t[s]):Object.assign(e,{[s]:t[s]}):Object.assign(e,{[s]:t[s]})}),e}class C{constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=b(m(this,"addOptions",{name:this.name}))),this.storage=b(m(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new C(t)}configure(t={}){const e=this.extend();return e.parent=this.parent,e.options=Q(this.options,t),e.storage=b(m(e,"addStorage",{name:e.name,options:e.options})),e}extend(t={}){const e=new C({...this.config,...t});return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=b(m(e,"addOptions",{name:e.name})),e.storage=b(m(e,"addStorage",{name:e.name,options:e.options})),e}}function Ot(n,t,e){const{from:s,to:r}=t,{blockSeparator:o=`

`,textSerializers:i={}}=e||{};let a="";return n.nodesBetween(s,r,(c,l,p,d)=>{var u;c.isBlock&&l>s&&(a+=o);const f=i==null?void 0:i[c.type.name];if(f)return p&&(a+=f({node:c,pos:l,parent:p,index:d,range:t})),!1;c.isText&&(a+=(u=c==null?void 0:c.text)===null||u===void 0?void 0:u.slice(Math.max(s,l)-l,r-l))}),a}function $t(n){return Object.fromEntries(Object.entries(n.nodes).filter(([,t])=>t.spec.toText).map(([t,e])=>[t,e.spec.toText]))}const Ke=C.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new O({key:new j("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:n}=this,{state:t,schema:e}=n,{doc:s,selection:r}=t,{ranges:o}=r,i=Math.min(...o.map(p=>p.$from.pos)),a=Math.max(...o.map(p=>p.$to.pos)),c=$t(e);return Ot(s,{from:i,to:a},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:c})}}})]}}),_e=()=>({editor:n,view:t})=>(requestAnimationFrame(()=>{var e;n.isDestroyed||(t.dom.blur(),(e=window==null?void 0:window.getSelection())===null||e===void 0||e.removeAllRanges())}),!0),Ve=(n=!1)=>({commands:t})=>t.setContent("",n),qe=()=>({state:n,tr:t,dispatch:e})=>{const{selection:s}=t,{ranges:r}=s;return e&&r.forEach(({$from:o,$to:i})=>{n.doc.nodesBetween(o.pos,i.pos,(a,c)=>{if(a.type.isText)return;const{doc:l,mapping:p}=t,d=l.resolve(p.map(c)),u=l.resolve(p.map(c+a.nodeSize)),f=d.blockRange(u);if(!f)return;const h=Jt(f);if(a.type.isTextblock){const{defaultType:g}=d.parent.contentMatchAt(d.index());t.setNodeMarkup(f.start,g)}(h||h===0)&&t.lift(f,h)})}),!0},We=n=>t=>n(t),Ue=()=>({state:n,dispatch:t})=>Qt(n,t),Je=(n,t)=>({editor:e,tr:s})=>{const{state:r}=e,o=r.doc.slice(n.from,n.to);s.deleteRange(n.from,n.to);const i=s.mapping.map(t);return s.insert(i,o.content),s.setSelection(new P(s.doc.resolve(i-1))),!0},Ge=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,s=e.$anchor.node();if(s.content.size>0)return!1;const r=n.selection.$anchor;for(let o=r.depth;o>0;o-=1)if(r.node(o).type===s.type){if(t){const a=r.before(o),c=r.after(o);n.delete(a,c).scrollIntoView()}return!0}return!1},Ye=n=>({tr:t,state:e,dispatch:s})=>{const r=E(n,e.schema),o=t.selection.$anchor;for(let i=o.depth;i>0;i-=1)if(o.node(i).type===r){if(s){const c=o.before(i),l=o.after(i);t.delete(c,l).scrollIntoView()}return!0}return!1},Qe=n=>({tr:t,dispatch:e})=>{const{from:s,to:r}=n;return e&&t.delete(s,r),!0},Xe=()=>({state:n,dispatch:t})=>Xt(n,t),Ze=()=>({commands:n})=>n.keyboardShortcut("Enter"),tn=()=>({state:n,dispatch:t})=>Zt(n,t);function W(n,t,e={strict:!0}){const s=Object.keys(t);return s.length?s.every(r=>e.strict?t[r]===n[r]:dt(t[r])?t[r].test(n[r]):t[r]===n[r]):!0}function rt(n,t,e={}){return n.find(s=>s.type===t&&W(s.attrs,e))}function en(n,t,e={}){return!!rt(n,t,e)}function ut(n,t,e={}){if(!n||!t)return;let s=n.parent.childAfter(n.parentOffset);if(n.parentOffset===s.offset&&s.offset!==0&&(s=n.parent.childBefore(n.parentOffset)),!s.node)return;const r=rt([...s.node.marks],t,e);if(!r)return;let o=s.index,i=n.start()+s.offset,a=o+1,c=i+s.node.nodeSize;for(rt([...s.node.marks],t,e);o>0&&r.isInSet(n.parent.child(o-1).marks);)o-=1,i-=n.parent.child(o).nodeSize;for(;a<n.parent.childCount&&en([...n.parent.child(a).marks],t,e);)c+=n.parent.child(a).nodeSize,a+=1;return{from:i,to:c}}function $(n,t){if(typeof n=="string"){if(!t.marks[n])throw Error(`There is no mark type named '${n}'. Maybe you forgot to add the extension?`);return t.marks[n]}return n}const nn=(n,t={})=>({tr:e,state:s,dispatch:r})=>{const o=$(n,s.schema),{doc:i,selection:a}=e,{$from:c,from:l,to:p}=a;if(r){const d=ut(c,o,t);if(d&&d.from<=l&&d.to>=p){const u=P.create(i,d.from,d.to);e.setSelection(u)}}return!0},sn=n=>t=>{const e=typeof n=="function"?n(t):n;for(let s=0;s<e.length;s+=1)if(e[s](t))return!0;return!1};function pt(n){return n instanceof P}function A(n=0,t=0,e=0){return Math.min(Math.max(n,t),e)}function Bt(n,t=null){if(!t)return null;const e=I.atStart(n),s=I.atEnd(n);if(t==="start"||t===!0)return e;if(t==="end")return s;const r=e.from,o=s.to;return t==="all"?P.create(n,A(0,r,o),A(n.content.size,r,o)):P.create(n,A(t,r,o),A(t,r,o))}function ft(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const rn=(n=null,t={})=>({editor:e,view:s,tr:r,dispatch:o})=>{t={scrollIntoView:!0,...t};const i=()=>{ft()&&s.dom.focus(),requestAnimationFrame(()=>{e.isDestroyed||(s.focus(),t!=null&&t.scrollIntoView&&e.commands.scrollIntoView())})};if(s.hasFocus()&&n===null||n===!1)return!0;if(o&&n===null&&!pt(e.state.selection))return i(),!0;const a=Bt(r.doc,n)||e.state.selection,c=e.state.selection.eq(a);return o&&(c||r.setSelection(a),c&&r.storedMarks&&r.setStoredMarks(r.storedMarks),i()),!0},on=(n,t)=>e=>n.every((s,r)=>t(s,{...e,index:r})),an=(n,t)=>({tr:e,commands:s})=>s.insertContentAt({from:e.selection.from,to:e.selection.to},n,t),Nt=n=>{const t=n.childNodes;for(let e=t.length-1;e>=0;e-=1){const s=t[e];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?n.removeChild(s):s.nodeType===1&&Nt(s)}return n};function bt(n){const t=`<body>${n}</body>`,e=new window.DOMParser().parseFromString(t,"text/html").body;return Nt(e)}function U(n,t,e){e={slice:!0,parseOptions:{},...e};const s=typeof n=="object"&&n!==null,r=typeof n=="string";if(s)try{return Array.isArray(n)&&n.length>0?_.fromArray(n.map(i=>t.nodeFromJSON(i))):t.nodeFromJSON(n)}catch(o){return console.warn("[tiptap warn]: Invalid content.","Passed value:",n,"Error:",o),U("",t,e)}if(r){const o=Ut.fromSchema(t);return e.slice?o.parseSlice(bt(n),e.parseOptions).content:o.parse(bt(n),e.parseOptions)}return U("",t,e)}function cn(n,t,e){const s=n.steps.length-1;if(s<t)return;const r=n.steps[s];if(!(r instanceof Gt||r instanceof Yt))return;const o=n.mapping.maps[s];let i=0;o.forEach((a,c,l,p)=>{i===0&&(i=p)}),n.setSelection(I.near(n.doc.resolve(i),e))}const ln=n=>n.toString().startsWith("<"),dn=(n,t,e)=>({tr:s,dispatch:r,editor:o})=>{if(r){e={parseOptions:{},updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...e};const i=U(t,o.schema,{parseOptions:{preserveWhitespace:"full",...e.parseOptions}});if(i.toString()==="<>")return!0;let{from:a,to:c}=typeof n=="number"?{from:n,to:n}:{from:n.from,to:n.to},l=!0,p=!0;if((ln(i)?i:[i]).forEach(f=>{f.check(),l=l?f.isText&&f.marks.length===0:!1,p=p?f.isBlock:!1}),a===c&&p){const{parent:f}=s.doc.resolve(a);f.isTextblock&&!f.type.spec.code&&!f.childCount&&(a-=1,c+=1)}let u;l?(Array.isArray(t)?u=t.map(f=>f.text||"").join(""):typeof t=="object"&&!!t&&!!t.text?u=t.text:u=t,s.insertText(u,a,c)):(u=i,s.replaceWith(a,c,u)),e.updateSelection&&cn(s,s.steps.length-1,-1),e.applyInputRules&&s.setMeta("applyInputRules",{from:a,text:u}),e.applyPasteRules&&s.setMeta("applyPasteRules",{from:a,text:u})}return!0},un=()=>({state:n,dispatch:t})=>te(n,t),pn=()=>({state:n,dispatch:t})=>ee(n,t),fn=()=>({state:n,dispatch:t})=>ne(n,t),hn=()=>({state:n,dispatch:t})=>se(n,t),mn=()=>({tr:n,state:t,dispatch:e})=>{try{const s=Et(t.doc,t.selection.$from.pos,-1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch{return!1}},gn=()=>({state:n,dispatch:t,tr:e})=>{try{const s=Et(n.doc,n.selection.$from.pos,1);return s==null?!1:(e.join(s,2),t&&t(e),!0)}catch{return!1}},yn=()=>({state:n,dispatch:t})=>re(n,t),vn=()=>({state:n,dispatch:t})=>oe(n,t);function jt(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function bn(n){const t=n.split(/-(?!$)/);let e=t[t.length-1];e==="Space"&&(e=" ");let s,r,o,i;for(let a=0;a<t.length-1;a+=1){const c=t[a];if(/^(cmd|meta|m)$/i.test(c))i=!0;else if(/^a(lt)?$/i.test(c))s=!0;else if(/^(c|ctrl|control)$/i.test(c))r=!0;else if(/^s(hift)?$/i.test(c))o=!0;else if(/^mod$/i.test(c))ft()||jt()?i=!0:r=!0;else throw new Error(`Unrecognized modifier name: ${c}`)}return s&&(e=`Alt-${e}`),r&&(e=`Ctrl-${e}`),i&&(e=`Meta-${e}`),o&&(e=`Shift-${e}`),e}const wn=n=>({editor:t,view:e,tr:s,dispatch:r})=>{const o=bn(n).split(/-(?!$)/),i=o.find(l=>!["Alt","Ctrl","Meta","Shift"].includes(l)),a=new KeyboardEvent("keydown",{key:i==="Space"?" ":i,altKey:o.includes("Alt"),ctrlKey:o.includes("Ctrl"),metaKey:o.includes("Meta"),shiftKey:o.includes("Shift"),bubbles:!0,cancelable:!0}),c=t.captureTransaction(()=>{e.someProp("handleKeyDown",l=>l(e,a))});return c==null||c.steps.forEach(l=>{const p=l.map(s.mapping);p&&r&&s.maybeStep(p)}),!0};function R(n,t,e={}){const{from:s,to:r,empty:o}=n.selection,i=t?E(t,n.schema):null,a=[];n.doc.nodesBetween(s,r,(d,u)=>{if(d.isText)return;const f=Math.max(s,u),h=Math.min(r,u+d.nodeSize);a.push({node:d,from:f,to:h})});const c=r-s,l=a.filter(d=>i?i.name===d.node.type.name:!0).filter(d=>W(d.node.attrs,e,{strict:!1}));return o?!!l.length:l.reduce((d,u)=>d+u.to-u.from,0)>=c}const kn=(n,t={})=>({state:e,dispatch:s})=>{const r=E(n,e.schema);return R(e,r,t)?ie(e,s):!1},Mn=()=>({state:n,dispatch:t})=>ae(n,t),Sn=n=>({state:t,dispatch:e})=>{const s=E(n,t.schema);return me(s)(t,e)},En=()=>({state:n,dispatch:t})=>ce(n,t);function X(n,t){return t.nodes[n]?"node":t.marks[n]?"mark":null}function wt(n,t){const e=typeof t=="string"?[t]:t;return Object.keys(n).reduce((s,r)=>(e.includes(r)||(s[r]=n[r]),s),{})}const xn=(n,t)=>({tr:e,state:s,dispatch:r})=>{let o=null,i=null;const a=X(typeof n=="string"?n:n.name,s.schema);return a?(a==="node"&&(o=E(n,s.schema)),a==="mark"&&(i=$(n,s.schema)),r&&e.selection.ranges.forEach(c=>{s.doc.nodesBetween(c.$from.pos,c.$to.pos,(l,p)=>{o&&o===l.type&&e.setNodeMarkup(p,void 0,wt(l.attrs,t)),i&&l.marks.length&&l.marks.forEach(d=>{i===d.type&&e.addMark(p,p+l.nodeSize,i.create(wt(d.attrs,t)))})})}),!0):!1},Tn=()=>({tr:n,dispatch:t})=>(t&&n.scrollIntoView(),!0),Cn=()=>({tr:n,commands:t})=>t.setTextSelection({from:0,to:n.doc.content.size}),Pn=()=>({state:n,dispatch:t})=>le(n,t),An=()=>({state:n,dispatch:t})=>de(n,t),On=()=>({state:n,dispatch:t})=>ue(n,t),$n=()=>({state:n,dispatch:t})=>pe(n,t),Bn=()=>({state:n,dispatch:t})=>fe(n,t);function Ht(n,t,e={}){return U(n,t,{slice:!1,parseOptions:e})}const Nn=(n,t=!1,e={})=>({tr:s,editor:r,dispatch:o})=>{const{doc:i}=s,a=Ht(n,r.schema,e);return o&&s.replaceWith(0,i.content.size,a).setMeta("preventUpdate",!t),!0};function It(n,t){const e=$(t,n.schema),{from:s,to:r,empty:o}=n.selection,i=[];o?(n.storedMarks&&i.push(...n.storedMarks),i.push(...n.selection.$head.marks())):n.doc.nodesBetween(s,r,c=>{i.push(...c.marks)});const a=i.find(c=>c.type.name===e.name);return a?{...a.attrs}:{}}function jn(n){for(let t=0;t<n.edgeCount;t+=1){const{type:e}=n.edge(t);if(e.isTextblock&&!e.hasRequiredAttrs())return e}return null}function Hn(n,t){for(let e=n.depth;e>0;e-=1){const s=n.node(e);if(t(s))return{pos:e>0?n.before(e):0,start:n.start(e),depth:e,node:s}}}function ht(n){return t=>Hn(t.$from,n)}function In(n,t){const e=Vt.fromSchema(t).serializeFragment(n),r=document.implementation.createHTMLDocument().createElement("div");return r.appendChild(e),r.innerHTML}function Dn(n,t){const e={from:0,to:n.content.size};return Ot(n,e,t)}function Fn(n,t){const e=E(t,n.schema),{from:s,to:r}=n.selection,o=[];n.doc.nodesBetween(s,r,a=>{o.push(a)});const i=o.reverse().find(a=>a.type.name===e.name);return i?{...i.attrs}:{}}function Rn(n,t){const e=X(typeof t=="string"?t:t.name,n.schema);return e==="node"?Fn(n,t):e==="mark"?It(n,t):{}}function Dt(n,t,e){const s=[];return n===t?e.resolve(n).marks().forEach(r=>{const o=e.resolve(n-1),i=ut(o,r.type);!i||s.push({mark:r,...i})}):e.nodesBetween(n,t,(r,o)=>{!r||(r==null?void 0:r.nodeSize)===void 0||s.push(...r.marks.map(i=>({from:o,to:o+r.nodeSize,mark:i})))}),s}function q(n,t,e){return Object.fromEntries(Object.entries(e).filter(([s])=>{const r=n.find(o=>o.type===t&&o.name===s);return r?r.attribute.keepOnSplit:!1}))}function ot(n,t,e={}){const{empty:s,ranges:r}=n.selection,o=t?$(t,n.schema):null;if(s)return!!(n.storedMarks||n.selection.$from.marks()).filter(d=>o?o.name===d.type.name:!0).find(d=>W(d.attrs,e,{strict:!1}));let i=0;const a=[];if(r.forEach(({$from:d,$to:u})=>{const f=d.pos,h=u.pos;n.doc.nodesBetween(f,h,(g,y)=>{if(!g.isText&&!g.marks.length)return;const v=Math.max(f,y),k=Math.min(h,y+g.nodeSize),w=k-v;i+=w,a.push(...g.marks.map(S=>({mark:S,from:v,to:k})))})}),i===0)return!1;const c=a.filter(d=>o?o.name===d.mark.type.name:!0).filter(d=>W(d.mark.attrs,e,{strict:!1})).reduce((d,u)=>d+u.to-u.from,0),l=a.filter(d=>o?d.mark.type!==o&&d.mark.type.excludes(o):!0).reduce((d,u)=>d+u.to-u.from,0);return(c>0?c+l:c)>=i}function Ln(n,t,e={}){if(!t)return R(n,null,e)||ot(n,null,e);const s=X(t,n.schema);return s==="node"?R(n,t,e):s==="mark"?ot(n,t,e):!1}function kt(n,t){const{nodeExtensions:e}=Y(t),s=e.find(i=>i.name===n);if(!s)return!1;const r={name:s.name,options:s.options,storage:s.storage},o=b(m(s,"group",r));return typeof o!="string"?!1:o.split(" ").includes("list")}function zn(n){var t;const e=(t=n.type.createAndFill())===null||t===void 0?void 0:t.toJSON(),s=n.toJSON();return JSON.stringify(e)===JSON.stringify(s)}function Kn(n){return n instanceof it}function Ft(n,t,e){const r=n.state.doc.content.size,o=A(t,0,r),i=A(e,0,r),a=n.coordsAtPos(o),c=n.coordsAtPos(i,-1),l=Math.min(a.top,c.top),p=Math.max(a.bottom,c.bottom),d=Math.min(a.left,c.left),u=Math.max(a.right,c.right),f=u-d,h=p-l,v={top:l,bottom:p,left:d,right:u,width:f,height:h,x:d,y:l};return{...v,toJSON:()=>v}}function _n(n,t,e){var s;const{selection:r}=t;let o=null;if(pt(r)&&(o=r.$cursor),o){const a=(s=n.storedMarks)!==null&&s!==void 0?s:o.marks();return!!e.isInSet(a)||!a.some(c=>c.type.excludes(e))}const{ranges:i}=r;return i.some(({$from:a,$to:c})=>{let l=a.depth===0?n.doc.inlineContent&&n.doc.type.allowsMarkType(e):!1;return n.doc.nodesBetween(a.pos,c.pos,(p,d,u)=>{if(l)return!1;if(p.isInline){const f=!u||u.type.allowsMarkType(e),h=!!e.isInSet(p.marks)||!p.marks.some(g=>g.type.excludes(e));l=f&&h}return!l}),l})}const Vn=(n,t={})=>({tr:e,state:s,dispatch:r})=>{const{selection:o}=e,{empty:i,ranges:a}=o,c=$(n,s.schema);if(r)if(i){const l=It(s,c);e.addStoredMark(c.create({...l,...t}))}else a.forEach(l=>{const p=l.$from.pos,d=l.$to.pos;s.doc.nodesBetween(p,d,(u,f)=>{const h=Math.max(f,p),g=Math.min(f+u.nodeSize,d);u.marks.find(v=>v.type===c)?u.marks.forEach(v=>{c===v.type&&e.addMark(h,g,c.create({...v.attrs,...t}))}):e.addMark(h,g,c.create(t))})});return _n(s,e,c)},qn=(n,t)=>({tr:e})=>(e.setMeta(n,t),!0),Wn=(n,t={})=>({state:e,dispatch:s,chain:r})=>{const o=E(n,e.schema);return o.isTextblock?r().command(({commands:i})=>mt(o,t)(e)?!0:i.clearNodes()).command(({state:i})=>mt(o,t)(i,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Un=n=>({tr:t,dispatch:e})=>{if(e){const{doc:s}=t,r=A(n,0,s.content.size),o=it.create(s,r);t.setSelection(o)}return!0},Jn=n=>({tr:t,dispatch:e})=>{if(e){const{doc:s}=t,{from:r,to:o}=typeof n=="number"?{from:n,to:n}:n,i=P.atStart(s).from,a=P.atEnd(s).to,c=A(r,i,a),l=A(o,i,a),p=P.create(s,c,l);t.setSelection(p)}return!0},Gn=n=>({state:t,dispatch:e})=>{const s=E(n,t.schema);return ge(s)(t,e)};function Mt(n,t){const e=n.storedMarks||n.selection.$to.parentOffset&&n.selection.$from.marks();if(e){const s=e.filter(r=>t==null?void 0:t.includes(r.type.name));n.tr.ensureMarks(s)}}const Yn=({keepMarks:n=!0}={})=>({tr:t,state:e,dispatch:s,editor:r})=>{const{selection:o,doc:i}=t,{$from:a,$to:c}=o,l=r.extensionManager.attributes,p=q(l,a.node().type.name,a.node().attrs);if(o instanceof it&&o.node.isBlock)return!a.parentOffset||!V(i,a.pos)?!1:(s&&(n&&Mt(e,r.extensionManager.splittableMarks),t.split(a.pos).scrollIntoView()),!0);if(!a.parent.isBlock)return!1;if(s){const d=c.parentOffset===c.parent.content.size;o instanceof P&&t.deleteSelection();const u=a.depth===0?void 0:jn(a.node(-1).contentMatchAt(a.indexAfter(-1)));let f=d&&u?[{type:u,attrs:p}]:void 0,h=V(t.doc,t.mapping.map(a.pos),1,f);if(!f&&!h&&V(t.doc,t.mapping.map(a.pos),1,u?[{type:u}]:void 0)&&(h=!0,f=u?[{type:u,attrs:p}]:void 0),h&&(t.split(t.mapping.map(a.pos),1,f),u&&!d&&!a.parentOffset&&a.parent.type!==u)){const g=t.mapping.map(a.before()),y=t.doc.resolve(g);a.node(-1).canReplaceWith(y.index(),y.index()+1,u)&&t.setNodeMarkup(t.mapping.map(a.before()),u)}n&&Mt(e,r.extensionManager.splittableMarks),t.scrollIntoView()}return!0},Qn=n=>({tr:t,state:e,dispatch:s,editor:r})=>{var o;const i=E(n,e.schema),{$from:a,$to:c}=e.selection,l=e.selection.node;if(l&&l.isBlock||a.depth<2||!a.sameParent(c))return!1;const p=a.node(-1);if(p.type!==i)return!1;const d=r.extensionManager.attributes;if(a.parent.content.size===0&&a.node(-1).childCount===a.indexAfter(-1)){if(a.depth===2||a.node(-3).type!==i||a.index(-2)!==a.node(-2).childCount-1)return!1;if(s){let y=_.empty;const v=a.index(-1)?1:a.index(-2)?2:3;for(let T=a.depth-v;T>=a.depth-3;T-=1)y=_.from(a.node(T).copy(y));const k=a.indexAfter(-1)<a.node(-2).childCount?1:a.indexAfter(-2)<a.node(-3).childCount?2:3,w=q(d,a.node().type.name,a.node().attrs),S=((o=i.contentMatch.defaultType)===null||o===void 0?void 0:o.createAndFill(w))||void 0;y=y.append(_.from(i.createAndFill(null,S)||void 0));const x=a.before(a.depth-(v-1));t.replace(x,a.after(-k),new qt(y,4-v,0));let M=-1;t.doc.nodesBetween(x,t.doc.content.size,(T,F)=>{if(M>-1)return!1;T.isTextblock&&T.content.size===0&&(M=F+1)}),M>-1&&t.setSelection(P.near(t.doc.resolve(M))),t.scrollIntoView()}return!0}const u=c.pos===a.end()?p.contentMatchAt(0).defaultType:null,f=q(d,p.type.name,p.attrs),h=q(d,a.node().type.name,a.node().attrs);t.delete(a.pos,c.pos);const g=u?[{type:i,attrs:f},{type:u,attrs:h}]:[{type:i,attrs:f}];if(!V(t.doc,a.pos,2))return!1;if(s){const{selection:y,storedMarks:v}=e,{splittableMarks:k}=r.extensionManager,w=v||y.$to.parentOffset&&y.$from.marks();if(t.split(a.pos,2,g).scrollIntoView(),!w||!s)return!0;const S=w.filter(x=>k.includes(x.type.name));t.ensureMarks(S)}return!0},et=(n,t)=>{const e=ht(i=>i.type===t)(n.selection);if(!e)return!0;const s=n.doc.resolve(Math.max(0,e.pos-1)).before(e.depth);if(s===void 0)return!0;const r=n.doc.nodeAt(s);return e.node.type===(r==null?void 0:r.type)&&xt(n.doc,e.pos)&&n.join(e.pos),!0},nt=(n,t)=>{const e=ht(i=>i.type===t)(n.selection);if(!e)return!0;const s=n.doc.resolve(e.start).after(e.depth);if(s===void 0)return!0;const r=n.doc.nodeAt(s);return e.node.type===(r==null?void 0:r.type)&&xt(n.doc,s)&&n.join(s),!0},Xn=(n,t,e,s={})=>({editor:r,tr:o,state:i,dispatch:a,chain:c,commands:l,can:p})=>{const{extensions:d,splittableMarks:u}=r.extensionManager,f=E(n,i.schema),h=E(t,i.schema),{selection:g,storedMarks:y}=i,{$from:v,$to:k}=g,w=v.blockRange(k),S=y||g.$to.parentOffset&&g.$from.marks();if(!w)return!1;const x=ht(M=>kt(M.type.name,d))(g);if(w.depth>=1&&x&&w.depth-x.depth<=1){if(x.node.type===f)return l.liftListItem(h);if(kt(x.node.type.name,d)&&f.validContent(x.node.content)&&a)return c().command(()=>(o.setNodeMarkup(x.pos,f),!0)).command(()=>et(o,f)).command(()=>nt(o,f)).run()}return!e||!S||!a?c().command(()=>p().wrapInList(f,s)?!0:l.clearNodes()).wrapInList(f,s).command(()=>et(o,f)).command(()=>nt(o,f)).run():c().command(()=>{const M=p().wrapInList(f,s),T=S.filter(F=>u.includes(F.type.name));return o.ensureMarks(T),M?!0:l.clearNodes()}).wrapInList(f,s).command(()=>et(o,f)).command(()=>nt(o,f)).run()},Zn=(n,t={},e={})=>({state:s,commands:r})=>{const{extendEmptyMarkRange:o=!1}=e,i=$(n,s.schema);return ot(s,i,t)?r.unsetMark(i,{extendEmptyMarkRange:o}):r.setMark(i,t)},ts=(n,t,e={})=>({state:s,commands:r})=>{const o=E(n,s.schema),i=E(t,s.schema);return R(s,o,e)?r.setNode(i):r.setNode(o,e)},es=(n,t={})=>({state:e,commands:s})=>{const r=E(n,e.schema);return R(e,r,t)?s.lift(r):s.wrapIn(r,t)},ns=()=>({state:n,dispatch:t})=>{const e=n.plugins;for(let s=0;s<e.length;s+=1){const r=e[s];let o;if(r.spec.isInputRules&&(o=r.getState(n))){if(t){const i=n.tr,a=o.transform;for(let c=a.steps.length-1;c>=0;c-=1)i.step(a.steps[c].invert(a.docs[c]));if(o.text){const c=i.doc.resolve(o.from).marks();i.replaceWith(o.from,o.to,n.schema.text(o.text,c))}else i.delete(o.from,o.to)}return!0}}return!1},ss=()=>({tr:n,dispatch:t})=>{const{selection:e}=n,{empty:s,ranges:r}=e;return s||t&&r.forEach(o=>{n.removeMark(o.$from.pos,o.$to.pos)}),!0},rs=(n,t={})=>({tr:e,state:s,dispatch:r})=>{var o;const{extendEmptyMarkRange:i=!1}=t,{selection:a}=e,c=$(n,s.schema),{$from:l,empty:p,ranges:d}=a;if(!r)return!0;if(p&&i){let{from:u,to:f}=a;const h=(o=l.marks().find(y=>y.type===c))===null||o===void 0?void 0:o.attrs,g=ut(l,c,h);g&&(u=g.from,f=g.to),e.removeMark(u,f,c)}else d.forEach(u=>{e.removeMark(u.$from.pos,u.$to.pos,c)});return e.removeStoredMark(c),!0},os=(n,t={})=>({tr:e,state:s,dispatch:r})=>{let o=null,i=null;const a=X(typeof n=="string"?n:n.name,s.schema);return a?(a==="node"&&(o=E(n,s.schema)),a==="mark"&&(i=$(n,s.schema)),r&&e.selection.ranges.forEach(c=>{const l=c.$from.pos,p=c.$to.pos;s.doc.nodesBetween(l,p,(d,u)=>{o&&o===d.type&&e.setNodeMarkup(u,void 0,{...d.attrs,...t}),i&&d.marks.length&&d.marks.forEach(f=>{if(i===f.type){const h=Math.max(u,l),g=Math.min(u+d.nodeSize,p);e.addMark(h,g,i.create({...f.attrs,...t}))}})})}),!0):!1},is=(n,t={})=>({state:e,dispatch:s})=>{const r=E(n,e.schema);return he(r,t)(e,s)},as=(n,t={})=>({state:e,dispatch:s})=>{const r=E(n,e.schema);return ye(r,t)(e,s)};var cs=Object.freeze({__proto__:null,blur:_e,clearContent:Ve,clearNodes:qe,command:We,createParagraphNear:Ue,cut:Je,deleteCurrentNode:Ge,deleteNode:Ye,deleteRange:Qe,deleteSelection:Xe,enter:Ze,exitCode:tn,extendMarkRange:nn,first:sn,focus:rn,forEach:on,insertContent:an,insertContentAt:dn,joinUp:un,joinDown:pn,joinBackward:fn,joinForward:hn,joinItemBackward:mn,joinItemForward:gn,joinTextblockBackward:yn,joinTextblockForward:vn,keyboardShortcut:wn,lift:kn,liftEmptyBlock:Mn,liftListItem:Sn,newlineInCode:En,resetAttributes:xn,scrollIntoView:Tn,selectAll:Cn,selectNodeBackward:Pn,selectNodeForward:An,selectParentNode:On,selectTextblockEnd:$n,selectTextblockStart:Bn,setContent:Nn,setMark:Vn,setMeta:qn,setNode:Wn,setNodeSelection:Un,setTextSelection:Jn,sinkListItem:Gn,splitBlock:Yn,splitListItem:Qn,toggleList:Xn,toggleMark:Zn,toggleNode:ts,toggleWrap:es,undoInputRule:ns,unsetAllMarks:ss,unsetMark:rs,updateAttributes:os,wrapIn:is,wrapInList:as});const ls=C.create({name:"commands",addCommands(){return{...cs}}}),ds=C.create({name:"editable",addProseMirrorPlugins(){return[new O({key:new j("editable"),props:{editable:()=>this.editor.options.editable}})]}}),us=C.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:n}=this;return[new O({key:new j("focusEvents"),props:{handleDOMEvents:{focus:(t,e)=>{n.isFocused=!0;const s=n.state.tr.setMeta("focus",{event:e}).setMeta("addToHistory",!1);return t.dispatch(s),!1},blur:(t,e)=>{n.isFocused=!1;const s=n.state.tr.setMeta("blur",{event:e}).setMeta("addToHistory",!1);return t.dispatch(s),!1}}}})]}}),ps=C.create({name:"keymap",addKeyboardShortcuts(){const n=()=>this.editor.commands.first(({commands:i})=>[()=>i.undoInputRule(),()=>i.command(({tr:a})=>{const{selection:c,doc:l}=a,{empty:p,$anchor:d}=c,{pos:u,parent:f}=d,h=d.parent.isTextblock&&u>0?a.doc.resolve(u-1):d,g=h.parent.type.spec.isolating,y=d.pos-d.parentOffset,v=g&&h.parent.childCount===1?y===d.pos:I.atStart(l).from===u;return!p||!f.type.isTextblock||f.textContent.length||!v||v&&d.parent.type.name==="paragraph"?!1:i.clearNodes()}),()=>i.deleteSelection(),()=>i.joinBackward(),()=>i.selectNodeBackward()]),t=()=>this.editor.commands.first(({commands:i})=>[()=>i.deleteSelection(),()=>i.deleteCurrentNode(),()=>i.joinForward(),()=>i.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:i})=>[()=>i.newlineInCode(),()=>i.createParagraphNear(),()=>i.liftEmptyBlock(),()=>i.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:n,"Mod-Backspace":n,"Shift-Backspace":n,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},r={...s},o={...s,"Ctrl-h":n,"Alt-Backspace":n,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return ft()||jt()?o:r},addProseMirrorPlugins(){return[new O({key:new j("clearDocument"),appendTransaction:(n,t,e)=>{if(!(n.some(h=>h.docChanged)&&!t.doc.eq(e.doc)))return;const{empty:r,from:o,to:i}=t.selection,a=I.atStart(t.doc).from,c=I.atEnd(t.doc).to;if(r||!(o===a&&i===c)||!(e.doc.textBetween(0,e.doc.content.size," "," ").length===0))return;const d=e.tr,u=J({state:e,transaction:d}),{commands:f}=new G({editor:this.editor,state:u});if(f.clearNodes(),!!d.steps.length)return d}})]}}),fs=C.create({name:"tabindex",addProseMirrorPlugins(){return[new O({key:new j("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});class B{constructor(t,e,s=!1,r=null){this.currentNode=null,this.actualDepth=null,this.isBlock=s,this.resolvedPos=t,this.editor=e,this.currentNode=r}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var t;return(t=this.actualDepth)!==null&&t!==void 0?t:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(t){let e=this.from,s=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can\u2019t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}e=this.from+1,s=this.to-1}this.editor.commands.insertContentAt({from:e,to:s},t)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;const t=this.resolvedPos.start(this.resolvedPos.depth-1),e=this.resolvedPos.doc.resolve(t);return new B(e,this.editor)}get before(){let t=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.from-3)),new B(t,this.editor)}get after(){let t=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return t.depth!==this.depth&&(t=this.resolvedPos.doc.resolve(this.to+3)),new B(t,this.editor)}get children(){const t=[];return this.node.content.forEach((e,s)=>{const r=e.isBlock&&!e.isTextblock,o=this.pos+s+1,i=this.resolvedPos.doc.resolve(o);if(!r&&i.depth<=this.depth)return;const a=new B(i,this.editor,r,r?e:null);r&&(a.actualDepth=this.depth+1),t.push(new B(i,this.editor,r,r?e:null))}),t}get firstChild(){return this.children[0]||null}get lastChild(){const t=this.children;return t[t.length-1]||null}closest(t,e={}){let s=null,r=this.parent;for(;r&&!s;){if(r.node.type.name===t)if(Object.keys(e).length>0){const o=r.node.attrs,i=Object.keys(e);for(let a=0;a<i.length;a+=1){const c=i[a];if(o[c]!==e[c])break}}else s=r;r=r.parent}return s}querySelector(t,e={}){return this.querySelectorAll(t,e,!0)[0]||null}querySelectorAll(t,e={},s=!1){let r=[];if(!this.children||this.children.length===0)return r;const o=Object.keys(e);return this.children.forEach(i=>{s&&r.length>0||(i.node.type.name===t&&o.every(c=>e[c]===i.node.attrs[c])&&r.push(i),!(s&&r.length>0)&&(r=r.concat(i.querySelectorAll(t,e,s))))}),r}setAttribute(t){const e=this.editor.state.selection;this.editor.chain().setTextSelection(this.from).updateAttributes(this.node.type.name,t).setTextSelection(e.from).run()}}const hs=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 1px !important;
  height: 1px !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}

.tippy-box[data-animation=fade][data-state=hidden] {
  opacity: 0
}`;function ms(n,t,e){const s=document.querySelector(`style[data-tiptap-style${e?`-${e}`:""}]`);if(s!==null)return s;const r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.setAttribute(`data-tiptap-style${e?`-${e}`:""}`,""),r.innerHTML=n,document.getElementsByTagName("head")[0].appendChild(r),r}class gs extends Te{constructor(t={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout(()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))},0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=ms(hs,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.view||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,e){const s=At(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],r=this.state.reconfigure({plugins:s});this.view.updateState(r)}unregisterPlugin(t){if(this.isDestroyed)return;const e=typeof t=="string"?`${t}$`:t.key,s=this.state.reconfigure({plugins:this.state.plugins.filter(r=>!r.key.startsWith(e))});this.view.updateState(s)}createExtensionManager(){var t,e;const r=[...this.options.enableCoreExtensions?[ds,Ke.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)===null||t===void 0?void 0:t.clipboardTextSerializer)===null||e===void 0?void 0:e.blockSeparator}),ls,us,ps,fs]:[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o==null?void 0:o.type));this.extensionManager=new H(r,this)}createCommandManager(){this.commandManager=new G({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const t=Ht(this.options.content,this.schema,this.options.parseOptions),e=Bt(t,this.options.autofocus);this.view=new Kt(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:zt.create({doc:t,selection:e||void 0})});const s=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(s),this.createNodeViews(),this.prependClass();const r=this.view.dom;r.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`tiptap ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(i=>{var a;return(a=this.capturedTransaction)===null||a===void 0?void 0:a.step(i)});return}const e=this.state.apply(t),s=!this.state.selection.eq(e.selection);this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t}),s&&this.emit("selectionUpdate",{editor:this,transaction:t});const r=t.getMeta("focus"),o=t.getMeta("blur");r&&this.emit("focus",{editor:this,event:r.event,transaction:t}),o&&this.emit("blur",{editor:this,event:o.event,transaction:t}),!(!t.docChanged||t.getMeta("preventUpdate"))&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return Rn(this.state,t)}isActive(t,e){const s=typeof t=="string"?t:null,r=typeof t=="string"?e:t;return Ln(this.state,s,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return In(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e=`

`,textSerializers:s={}}=t||{};return Dn(this.state.doc,{blockSeparator:e,textSerializers:{...$t(this.schema),...s}})}get isEmpty(){return zn(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var t;return!(!((t=this.view)===null||t===void 0)&&t.docView)}$node(t,e){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelector(t,e))||null}$nodes(t,e){var s;return((s=this.$doc)===null||s===void 0?void 0:s.querySelectorAll(t,e))||null}$pos(t){const e=this.state.doc.resolve(t);return new B(e,this)}get $doc(){return this.$pos(0)}}function ys(n){return new $e({find:n.find,handler:({state:t,range:e,match:s})=>{const r=b(n.getAttributes,void 0,s);if(r===!1||r===null)return null;const{tr:o}=t,i=s[s.length-1],a=s[0];if(i){const c=a.search(/\S/),l=e.from+a.indexOf(i),p=l+i.length;if(Dt(e.from,e.to,t.doc).filter(f=>f.mark.type.excluded.find(g=>g===n.type&&g!==f.mark.type)).filter(f=>f.to>l).length)return null;p<e.to&&o.delete(p,e.to),l>e.from&&o.delete(e.from+c,l);const u=e.from+c+i.length;o.addMark(e.from+c,u,n.type.create(r||{})),o.removeStoredMark(n.type)}}})}class L{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=b(m(this,"addOptions",{name:this.name}))),this.storage=b(m(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new L(t)}configure(t={}){const e=this.extend();return e.options=Q(this.options,t),e.storage=b(m(e,"addStorage",{name:e.name,options:e.options})),e}extend(t={}){const e=new L({...this.config,...t});return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=b(m(e,"addOptions",{name:e.name})),e.storage=b(m(e,"addStorage",{name:e.name,options:e.options})),e}static handleExit({editor:t,mark:e}){const{tr:s}=t.state,r=t.state.selection.$from;if(r.pos===r.end()){const i=r.marks();if(!!!i.find(l=>(l==null?void 0:l.type.name)===e.name))return!1;const c=i.find(l=>(l==null?void 0:l.type.name)===e.name);return c&&s.removeStoredMark(c),s.insertText(" ",r.pos),t.view.dispatch(s),!0}return!1}}class D{constructor(t={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&Object.keys(t.defaultOptions).length>0&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=b(m(this,"addOptions",{name:this.name}))),this.storage=b(m(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new D(t)}configure(t={}){const e=this.extend();return e.options=Q(this.options,t),e.storage=b(m(e,"addStorage",{name:e.name,options:e.options})),e}extend(t={}){const e=new D({...this.config,...t});return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=b(m(e,"addOptions",{name:e.name})),e.storage=b(m(e,"addStorage",{name:e.name,options:e.options})),e}}function vs(n){return new He({find:n.find,handler:({state:t,range:e,match:s,pasteEvent:r})=>{const o=b(n.getAttributes,void 0,s,r);if(o===!1||o===null)return null;const{tr:i}=t,a=s[s.length-1],c=s[0];let l=e.to;if(a){const p=c.search(/\S/),d=e.from+c.indexOf(a),u=d+a.length;if(Dt(e.from,e.to,t.doc).filter(h=>h.mark.type.excluded.find(y=>y===n.type&&y!==h.mark.type)).filter(h=>h.to>d).length)return null;u<e.to&&i.delete(u,e.to),d>e.from&&i.delete(e.from+p,d),l=e.from+p+a.length,i.addMark(e.from+p,l,n.type.create(o||{})),i.removeStoredMark(n.type)}}})}const bs=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))$/,ws=/(?:^|\s)(==(?!\s+==)((?:[^=]+))==(?!\s+==))/g,Bs=L.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:n=>n.getAttribute("data-color")||n.style.backgroundColor,renderHTML:n=>n.color?{"data-color":n.color,style:`background-color: ${n.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:n}){return["mark",lt(this.options.HTMLAttributes,n),0]},addCommands(){return{setHighlight:n=>({commands:t})=>t.setMark(this.name,n),toggleHighlight:n=>({commands:t})=>t.toggleMark(this.name,n),unsetHighlight:()=>({commands:n})=>n.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[ys({find:bs,type:this.type})]},addPasteRules(){return[vs({find:ws,type:this.type})]}}),Ns=D.create({name:"doc",topNode:!0,content:"block+"}),js=D.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:n}){return["p",lt(this.options.HTMLAttributes,n),0]},addCommands(){return{setParagraph:()=>({commands:n})=>n.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Hs=D.create({name:"text",group:"inline"});class ks{constructor({editor:t,element:e,view:s,tippyOptions:r={},updateDelay:o=250,shouldShow:i}){this.preventHide=!1,this.shouldShow=({view:a,state:c,from:l,to:p})=>{const{doc:d,selection:u}=c,{empty:f}=u,h=!d.textBetween(l,p).length&&pt(c.selection),g=this.element.contains(document.activeElement);return!(!(a.hasFocus()||g)||f||h||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:a})=>{var c;if(this.preventHide){this.preventHide=!1;return}(a==null?void 0:a.relatedTarget)&&((c=this.element.parentNode)===null||c===void 0?void 0:c.contains(a.relatedTarget))||this.hide()},this.tippyBlurHandler=a=>{this.blurHandler({event:a})},this.handleDebouncedUpdate=(a,c)=>{const l=!(c!=null&&c.selection.eq(a.state.selection)),p=!(c!=null&&c.doc.eq(a.state.doc));!l&&!p||(this.updateDebounceTimer&&clearTimeout(this.updateDebounceTimer),this.updateDebounceTimer=window.setTimeout(()=>{this.updateHandler(a,l,p,c)},this.updateDelay))},this.updateHandler=(a,c,l,p)=>{var d,u,f;const{state:h,composing:g}=a,{selection:y}=h;if(g||!c&&!l)return;this.createTooltip();const{ranges:k}=y,w=Math.min(...k.map(M=>M.$from.pos)),S=Math.max(...k.map(M=>M.$to.pos));if(!((d=this.shouldShow)===null||d===void 0?void 0:d.call(this,{editor:this.editor,view:a,state:h,oldState:p,from:w,to:S}))){this.hide();return}(u=this.tippy)===null||u===void 0||u.setProps({getReferenceClientRect:((f=this.tippyOptions)===null||f===void 0?void 0:f.getReferenceClientRect)||(()=>{if(Kn(h.selection)){let M=a.nodeDOM(w);const T=M.dataset.nodeViewWrapper?M:M.querySelector("[data-node-view-wrapper]");if(T&&(M=T.firstChild),M)return M.getBoundingClientRect()}return Ft(a,w,S)})}),this.show()},this.editor=t,this.element=e,this.view=s,this.updateDelay=o,i&&(this.shouldShow=i),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=r,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:t}=this.editor.options,e=!!t.parentElement;this.tippy||!e||(this.tippy=Tt(t,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(t,e){const{state:s}=t,r=s.selection.$from.pos!==s.selection.$to.pos;if(this.updateDelay>0&&r){this.handleDebouncedUpdate(t,e);return}const o=!(e!=null&&e.selection.eq(t.state.selection)),i=!(e!=null&&e.doc.eq(t.state.doc));this.updateHandler(t,o,i,e)}show(){var t;(t=this.tippy)===null||t===void 0||t.show()}hide(){var t;(t=this.tippy)===null||t===void 0||t.hide()}destroy(){var t,e;!((t=this.tippy)===null||t===void 0)&&t.popper.firstChild&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Rt=n=>new O({key:typeof n.pluginKey=="string"?new j(n.pluginKey):n.pluginKey,view:t=>new ks({view:t,...n})});C.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[Rt({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow})]:[]}});class Ms{constructor({editor:t,element:e,view:s,tippyOptions:r={},shouldShow:o}){this.preventHide=!1,this.shouldShow=({view:i,state:a})=>{const{selection:c}=a,{$anchor:l,empty:p}=c,d=l.depth===1,u=l.parent.isTextblock&&!l.parent.type.spec.code&&!l.parent.textContent;return!(!i.hasFocus()||!p||!d||!u||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout(()=>this.update(this.editor.view))},this.blurHandler=({event:i})=>{var a;if(this.preventHide){this.preventHide=!1;return}(i==null?void 0:i.relatedTarget)&&((a=this.element.parentNode)===null||a===void 0?void 0:a.contains(i.relatedTarget))||this.hide()},this.tippyBlurHandler=i=>{this.blurHandler({event:i})},this.editor=t,this.element=e,this.view=s,o&&(this.shouldShow=o),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=r,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:t}=this.editor.options,e=!!t.parentElement;this.tippy||!e||(this.tippy=Tt(t,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(t,e){var s,r,o;const{state:i}=t,{doc:a,selection:c}=i,{from:l,to:p}=c;if(e&&e.doc.eq(a)&&e.selection.eq(c))return;if(this.createTooltip(),!((s=this.shouldShow)===null||s===void 0?void 0:s.call(this,{editor:this.editor,view:t,state:i,oldState:e}))){this.hide();return}(r=this.tippy)===null||r===void 0||r.setProps({getReferenceClientRect:((o=this.tippyOptions)===null||o===void 0?void 0:o.getReferenceClientRect)||(()=>Ft(t,l,p))}),this.show()}show(){var t;(t=this.tippy)===null||t===void 0||t.show()}hide(){var t;(t=this.tippy)===null||t===void 0||t.hide()}destroy(){var t,e;!((t=this.tippy)===null||t===void 0)&&t.popper.firstChild&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),(e=this.tippy)===null||e===void 0||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Lt=n=>new O({key:typeof n.pluginKey=="string"?new j(n.pluginKey):n.pluginKey,view:t=>new Ms({view:t,...n})});C.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[Lt({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}});z({name:"BubbleMenu",props:{pluginKey:{type:[String,Object],default:"bubbleMenu"},editor:{type:Object,required:!0},updateDelay:{type:Number,default:void 0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(n,{slots:t}){const e=at(null);return Ct(()=>{const{updateDelay:s,editor:r,pluginKey:o,shouldShow:i,tippyOptions:a}=n;r.registerPlugin(Rt({updateDelay:s,editor:r,element:e.value,pluginKey:o,shouldShow:i,tippyOptions:a}))}),ct(()=>{const{pluginKey:s,editor:r}=n;r.unregisterPlugin(s)}),()=>{var s;return N("div",{ref:e},(s=t.default)===null||s===void 0?void 0:s.call(t))}}});function St(n){return we((t,e)=>({get(){return t(),n},set(s){n=s,requestAnimationFrame(()=>{requestAnimationFrame(()=>{e()})})}}))}class Is extends gs{constructor(t={}){return super(t),this.vueRenderers=ve(new Map),this.contentComponent=null,this.reactiveState=St(this.view.state),this.reactiveExtensionStorage=St(this.extensionStorage),this.on("transaction",()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage}),be(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(t,e){super.registerPlugin(t,e),this.reactiveState.value=this.view.state}unregisterPlugin(t){super.unregisterPlugin(t),this.reactiveState.value=this.view.state}}const Ds=z({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(n){const t=at(),e=xe();return ke(()=>{const s=n.editor;s&&s.options.element&&t.value&&Se(()=>{if(!t.value||!s.options.element.firstChild)return;const r=Ee(t.value);t.value.append(...s.options.element.childNodes),s.contentComponent=e.ctx._,s.setOptions({element:r}),s.createNodeViews()})}),ct(()=>{const s=n.editor;if(!s||(s.isDestroyed||s.view.setProps({nodeViews:{}}),s.contentComponent=null,!s.options.element.firstChild))return;const r=document.createElement("div");r.append(...s.options.element.childNodes),s.setOptions({element:r})}),{rootEl:t}},render(){const n=[];return this.editor&&this.editor.vueRenderers.forEach(t=>{const e=N(Me,{to:t.teleportElement,key:t.id},N(t.component,{ref:t.id,...t.props}));n.push(e)}),N("div",{ref:t=>{this.rootEl=t}},...n)}});z({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(n,{slots:t}){const e=at(null);return Ct(()=>{const{pluginKey:s,editor:r,tippyOptions:o,shouldShow:i}=n;r.registerPlugin(Lt({pluginKey:s,editor:r,element:e.value,tippyOptions:o,shouldShow:i}))}),ct(()=>{const{pluginKey:s,editor:r}=n;r.unregisterPlugin(s)}),()=>{var s;return N("div",{ref:e},(s=t.default)===null||s===void 0?void 0:s.call(t))}}});z({name:"NodeViewContent",props:{as:{type:String,default:"div"}},render(){return N(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}});z({name:"NodeViewWrapper",props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var n,t;return N(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},(t=(n=this.$slots).default)===null||t===void 0?void 0:t.call(n))}});export{Ns as D,Ds as E,Bs as H,js as P,Hs as T,Is as a};
